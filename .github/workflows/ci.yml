name: CI

on:
  push:
  pull_request:

permissions:
  contents: read

jobs:
  test:
    name: Perl ${{ matrix.perl }} (container) on ubuntu-latest
    runs-on: ubuntu-latest

    strategy:
      fail-fast: false
      matrix:
        perl: ["5.38", "5.40", "5.42"]

    # Workaround (Feb 2026): shogo82148/actions-setup-perl is intermittently failing
    # with "failed to verify ..." (attestation verification). To avoid depending on it,
    # run tests inside official Perl Docker images instead.
    container:
      image: perl:${{ matrix.perl }}

    steps:
      - uses: actions/checkout@v4

      - name: Perl version
        run: perl -V

      - name: Install dependencies
        run: |
          cpanm --notest --quiet App::cpanminus
          cpanm --notest --quiet --installdeps . --with-configure --with-develop

      - name: Build
        run: perl Makefile.PL && make

      - name: Test
        run: make test
